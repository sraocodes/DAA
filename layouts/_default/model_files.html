{{ define "main" }}
<div class="container">
    <h3>{{ .Title }}</h3>
    <p>{{ .Description }}</p>

    <!-- Accordion Wrapper -->
    <div id="accordion">
        <!-- Loop over each section -->
        {{ range $index, $section := .Params.sections }}
        <div class="card">
            <!-- Section Title, Description, and Optional Image -->
            <div class="card-header" id="heading{{ $index }}">
                <h4>{{ $section.section_name }}</h4>
                <p>{{ $section.description | markdownify | safeHTML }}</p>
                {{ if $section.image }}
                <img src="{{ $section.image | relURL }}" alt="{{ $section.section_name }}" class="img-fluid">
                {{ end }}
            </div>

            <!-- Collapsible Table with Lottie Animation -->
            {{ if $section.table }}
            <div class="card-body">
                <h5 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTable{{ $index }}" aria-expanded="false" aria-controls="collapseTable{{ $index }}">
                        {{ $section.table.title }}
                        <!-- Lottie Animation Next to Table Title -->
                        <div class="lottie-small" style="width: 50px; height: 50px; display: inline-block;">
                            <div id="lottie-animation-table-{{ $index }}" style="width: 100%; height: 100%;"></div>
                        </div>
                    </button>
                </h5>

                <div id="collapseTable{{ $index }}" class="collapse" aria-labelledby="heading{{ $index }}" data-parent="#accordion">
                    <div class="table-responsive ml-3">
                        <table class="table table-bordered table-striped table-hover">
                            <thead>
                                <tr>
                                    {{ range $section.table.headers }}
                                    <th>{{ . }}</th>
                                    {{ end }}
                                </tr>
                            </thead>
                            <tbody>
                                {{ range $section.table.rows }}
                                <tr>
                                    {{ range . }}
                                    <td>{{ . | markdownify | safeHTML }}</td>
                                    {{ end }}
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
        {{ end }}
    </div>

    <script>
        // Load Lottie animations for each table section
        {{ range $index, $_ := .Params.sections }}
        {{ if $_.table }}
        lottie.loadAnimation({
            container: document.getElementById('lottie-animation-table-{{ $index }}'),
            renderer: 'svg',
            loop: true,
            autoplay: true,
            path: '/anim/coffee_code.json'
        });
        {{ end }}
        {{ end }}
    </script>
</div>
{{ end }}
